ifndef::imagesdir[:imagesdir: ../images]

[[section-solution-strategy]]
== Lösungsstrategie

=== Überblick

Die Gesamtlösung besteht aus **zwei unabhängigen, aber komplementären Subsystemen**, die über eine gemeinsame Flask-REST-API kommunizieren:

[cols="1,2,2" options="header"]
|===
| Subsystem | Hauptaufgabe | Technologischer Ansatz

| **Puzzle Generator**
| Erzeugt Test-Puzzles mit Kamera-Simulation
| Parametrische Geometrie + physikbasierte Kamera Effekte

| **Puzzle Solver**
| Löst Puzzle-Bilder durch Computer Vision
| Clean Up -> Segmentation → Edge Detection → Matching → Solving
|===


=== Strategien pro Subsystem

==== Puzzle Generator

**Wichtigste Entscheidungen**:

[cols="1,2,2" options="header"]
|===
| Aspekt | Lösung | Begründung

| **Pasende Puzzle-Teile**
| `ReversedCut` wrapper invertiert Punktreihenfolge (male/female)
| Garantiert passende Puzzle-Teile

| **Piece Placement**
| Grid-basiert mit Safe Zones
| Verhindert Überlappung trotz Rotation

| **Shadow Rendering**
| Nutzt skalierte Boundingboxes für die Performance
| Simuliert realistische Bilder des finalen Roboters

| **Camera Effects**
| Effekte basierend auf OpenCV und NumPy Bibliotheken
| Simuliert tatsächliche Verzerrungen durch die Kamera-Aufnahme

|===

==== Puzzle Solver

**Wichtigste Entscheidungen**:

[cols="2,2,2" options="header"]
|===
| Problem | Lösung | Begründung

| **Bild-Entzerrung** +
| OpenCV `undistort()` mit calibration_params.json
| Muss VOR Segmentierung erfolgen, sonst sind Konturen gekrümmt

| **Teile erkennen** +
(Schwarz auf weissem Grund)
| Otsu-Verfahren um Puzzleteil zu erkennen
| Robuster Algorithmus um Schwellwerte zwischen Vordergrund und Hintergrund zu definieren.

| **Eck-Erkennung** +
(Tabs/Slots verfälschen Ecken)
| Rechteckige Bounding Box mit Snap zum nächsten Konturpunkt
| Suboptimale Lösung da es nicht nur Rechteckige Puzzles gibt. Für Rechteckige Puzzles dafür sehr zuverlässig


| **Edge Matching** +
(Passende Kanten finden)
| Kurvenkorrelation + filter auf Tab-Slot matches
| Tab-Slot filter verbessert Performance

| **Puzzle-Rekonstruktion**
| Start in Ecke + Greedy Algorithmus
| Einfache Lösung und nicht zu performance intensiv, da alle Teile ≥1 flache Kante haben

|===

==== Visualisierung

**Strategie**: Jede Pipeline-Stufe erzeugt Outputs in `app/static/output/`

[cols="1,2,2" options="header"]
|===
| Stufe | Visualisierung | Nutzen

| Segmentation
| Teile mit transparentem Hintergrund
| Kontur-Qualität, Überlappung prüfen

| Edge Detection
| Konturen + Ecken + Kanten mit Labels
| Gewählte Eckpunkte und Kantenklassifikation prüfen

| Matching
| Side-by-Side Kantenpaare mit Bewertung
| False-Positive Identifikation

| Solution
| Grid-Layout + Rendered Assembly
| End-to-End Plausibilität
|===
